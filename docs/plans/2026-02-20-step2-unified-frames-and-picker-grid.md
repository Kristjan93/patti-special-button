# Step 2: Unified 160x160 Frames + Picker Grid

## Goal

Expand the Python script to generate 160x160 PNG frames. Both the menu bar icon and the picker grid load the same pre-processed PNGs. This eliminates GIFAnimator (no runtime GIF decoding) and removes the source GIFs from the app bundle. Also fix inconsistent name capitalization in the manifest.

## Status: in progress

## Design decisions (brainstormed 2026-02-20)

### Performance: per-cell FrameAnimator
Each cell owns its own `FrameAnimator` as a `@StateObject`. `LazyVGrid` naturally limits active animators to visible cells via `onAppear`/`onDisappear`. Simple and isolated — optimize to a shared tick later only if profiling shows a problem.

### Frame loading: duplicate, don't share
AppDelegate and FrameAnimator both iterate `frame_00.png, frame_01.png, ...` but want different sizing (`20pt + isTemplate` vs full size). Keep the loops separate — ~15 lines each, different behavior. May extract a shared service later.

### Timer: `Timer` for FrameAnimator
`DispatchSourceTimer` in AppDelegate has no menu-bar-specific reason — both work identically on main thread. `Timer` is simpler and more idiomatic for a SwiftUI `ObservableObject`. AppDelegate keeps `DispatchSourceTimer` (working code, no reason to touch it).

### Selection state: `@AppStorage`
`@AppStorage("selectedButtId")` in ButtPickerView reads/writes UserDefaults directly. SwiftUI re-renders on change (highlight moves). AppDelegate already observes `UserDefaults.didChangeNotification` → reloads frames. Zero coordination code — UserDefaults is the shared bus.

### Grid layout: `LazyVGrid` with adaptive columns
`GridItem(.adaptive(minimum: 100))` fills available width (~4-5 per row at 500pt). Wrapped in `ScrollView` for the ~10 rows of content.

## What changes

### `buttsss/brazilian-butt-lift.py`

- Change `FRAME_SIZE = (40, 40)` to `FRAME_SIZE = (160, 160)`
- Update `display_name()` to produce consistent title-case names:
  1. Replace hyphens/underscores with spaces
  2. Split camelCase boundaries: `re.sub(r"([a-z])([A-Z])", r"\1 \2", ...)`
  3. Capitalize first letter of each word, preserve rest (so "II" stays "II", not "Ii")
- Remove `gifFilename` from the manifest entry dict (no longer needed)
- Then re-run: `cd buttsss && source .venv/bin/activate && python3 brazilian-butt-lift.py`

### Delete `GIFAnimator.swift`

No longer needed — we don't decode GIFs at runtime.

### New: `FrameAnimator.swift`

Simple ObservableObject that replaces GIFAnimator:
- Takes a butt id in init
- Loads `ButtFrames/<id>/frame_00.png`, `frame_01.png`, ... (same loop logic as `AppDelegate.loadFrameImages()` but does NOT set `isTemplate = true` or resize to 20x20)
- `@Published var currentFrame: NSImage?` for SwiftUI binding
- `start()` / `stop()` — Timer cycles frames at 0.1s interval
- `onAppear` calls `start()`, `onDisappear` calls `stop()`

### `AnimatedButtCell.swift`

- Use `FrameAnimator` instead of `GIFAnimator`
- Display frames at 80pt (the 160x160 PNGs are 80pt @2x — crisp)

### `ButtPickerView.swift`

- Restore the `LazyVGrid` content (remove "TODO" placeholder from Step 1)
- Load manifest, show all butts in grid, highlight selected, write selection to UserDefaults on tap

### `ButtInfo.swift`

- Remove `gifFilename` property (no longer in manifest)

### `ButtFrames/manifest.json`

- Regenerated by the Python script: `gifFilename` removed, names now consistently title-cased

### Xcode project (`project.pbxproj`)

- Remove `fractured-but-whole` folder reference (GIFs no longer needed in bundle)
- Remove corresponding `PBXBuildFile` and `PBXFileReference` entries

## Done when

- [ ] All 47 butts visible in the picker grid, animating at ~80pt
- [ ] Names are consistently capitalized ("Async Butt", "Censored Butt", "Easter Bunny", "Bouncing Butt II")
- [ ] Click a butt → menu bar icon switches immediately
- [ ] Selection persists across app restarts (stored in UserDefaults)
- [ ] Menu bar animation still looks correct (not blurry — 160px downscaled to 20pt is fine)
- [ ] App bundle no longer contains source GIFs (smaller bundle)
